{"version":3,"file":"WorkerFS.js","sourceRoot":"","sources":["../../../src/backend/WorkerFS.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseFileSystem, FileSystem, BFSOneArgCallback, BFSCallback, FileSystemOptions } from '../core/file_system';\nimport { ApiError, ErrorCode } from '../core/api_error';\nimport { FileFlag } from '../core/file_flag';\nimport { buffer2ArrayBuffer, arrayBuffer2Buffer, emptyBuffer } from '../core/util';\nimport { File, BaseFile } from '../core/file';\nimport { default as Stats } from '../core/stats';\nimport PreloadFile from '../generic/preload_file';\nimport fs from '../core/node_fs';\nimport Cred from '../core/cred';\nimport { Buffer } from 'buffer';\n\n/**\n * @hidden\n */\ndeclare const importScripts: Function;\n\n/**\n * @hidden\n */\ninterface IBrowserFSMessage {\n\tbrowserfsMessage: boolean;\n}\n\n/**\n * @hidden\n */\nenum SpecialArgType {\n\t// Callback\n\tCB,\n\t// File descriptor\n\tFD,\n\t// API error\n\tAPI_ERROR,\n\t// Stats object\n\tSTATS,\n\t// Initial probe for file system information.\n\tPROBE,\n\t// FileFlag object.\n\tFILEFLAG,\n\t// Buffer object.\n\tBUFFER,\n\t// Generic Error object.\n\tERROR,\n}\n\n/**\n * @hidden\n */\ninterface ISpecialArgument {\n\ttype: SpecialArgType;\n}\n\n/**\n * @hidden\n */\ninterface IProbeResponse extends ISpecialArgument {\n\tisReadOnly: boolean;\n\tsupportsLinks: boolean;\n\tsupportsProps: boolean;\n}\n\n/**\n * @hidden\n */\ninterface ICallbackArgument extends ISpecialArgument {\n\t// The callback ID.\n\tid: number;\n}\n\n/**\n * Converts callback arguments into ICallbackArgument objects, and back\n * again.\n * @hidden\n */\nclass CallbackArgumentConverter {\n\tprivate _callbacks: { [id: number]: Function } = {};\n\tprivate _nextId: number = 0;\n\n\tpublic toRemoteArg(cb: Function): ICallbackArgument {\n\t\tconst id = this._nextId++;\n\t\tthis._callbacks[id] = cb;\n\t\treturn {\n\t\t\ttype: SpecialArgType.CB,\n\t\t\tid: id,\n\t\t};\n\t}\n\n\tpublic toLocalArg(id: number): Function {\n\t\tconst cb = this._callbacks[id];\n\t\tdelete this._callbacks[id];\n\t\treturn cb;\n\t}\n}\n\n/**\n * @hidden\n */\ninterface IFileDescriptorArgument extends ISpecialArgument {\n\t// The file descriptor's id on the remote side.\n\tid: number;\n\t// The entire file's data, as an array buffer.\n\tdata: ArrayBuffer | SharedArrayBuffer;\n\t// The file's stat object, as an array buffer.\n\tstat: ArrayBuffer | SharedArrayBuffer;\n\t// The path to the file.\n\tpath: string;\n\t// The flag of the open file descriptor.\n\tflag: string;\n}\n\n/**\n * @hidden\n */\nclass FileDescriptorArgumentConverter {\n\tprivate _fileDescriptors: { [id: number]: File } = {};\n\tprivate _nextId: number = 0;\n\n\tpublic toRemoteArg(fd: File, p: string, flag: FileFlag, cb: BFSCallback<IFileDescriptorArgument>): void {\n\t\tconst id = this._nextId++;\n\t\tlet data: ArrayBuffer | SharedArrayBuffer;\n\t\tlet stat: ArrayBuffer | SharedArrayBuffer;\n\t\tthis._fileDescriptors[id] = fd;\n\n\t\t// Extract needed information asynchronously.\n\t\tfd.stat((err, stats) => {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t} else {\n\t\t\t\tstat = bufferToTransferrableObject(stats!.toBuffer());\n\t\t\t\t// If it's a readable flag, we need to grab contents.\n\t\t\t\tif (flag.isReadable()) {\n\t\t\t\t\tfd.read(Buffer.alloc(stats!.size), 0, stats!.size, 0, (err?: ApiError | null, bytesRead?: number, buff?: Buffer) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcb(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdata = bufferToTransferrableObject(buff!);\n\t\t\t\t\t\t\tcb(null, {\n\t\t\t\t\t\t\t\ttype: SpecialArgType.FD,\n\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\t\t\tstat: stat,\n\t\t\t\t\t\t\t\tpath: p,\n\t\t\t\t\t\t\t\tflag: flag.getFlagString(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// File is not readable, which means writing to it will append or\n\t\t\t\t\t// truncate/replace existing contents. Return an empty arraybuffer.\n\t\t\t\t\tcb(null, {\n\t\t\t\t\t\ttype: SpecialArgType.FD,\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tdata: new ArrayBuffer(0),\n\t\t\t\t\t\tstat: stat,\n\t\t\t\t\t\tpath: p,\n\t\t\t\t\t\tflag: flag.getFlagString(),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic applyFdAPIRequest(request: IAPIRequest, cb: BFSOneArgCallback): void {\n\t\tconst fdArg = <IFileDescriptorArgument>request.args[0];\n\t\tthis._applyFdChanges(fdArg, (err, fd?) => {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t} else {\n\t\t\t\t// Apply method on now-changed file descriptor.\n\t\t\t\t(<any>fd)[request.method]((e?: ApiError) => {\n\t\t\t\t\tif (request.method === 'close') {\n\t\t\t\t\t\tdelete this._fileDescriptors[fdArg.id];\n\t\t\t\t\t}\n\t\t\t\t\tcb(e);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _applyFdChanges(remoteFd: IFileDescriptorArgument, cb: BFSCallback<File>): void {\n\t\tconst fd = this._fileDescriptors[remoteFd.id],\n\t\t\tdata = transferrableObjectToBuffer(remoteFd.data),\n\t\t\tremoteStats = Stats.fromBuffer(transferrableObjectToBuffer(remoteFd.stat));\n\n\t\t// Write data if the file is writable.\n\t\tconst flag = FileFlag.getFileFlag(remoteFd.flag);\n\t\tif (flag.isWriteable()) {\n\t\t\t// Appendable: Write to end of file.\n\t\t\t// Writeable: Replace entire contents of file.\n\t\t\tfd.write(data, 0, data.length, flag.isAppendable() ? fd.getPos()! : 0, (e?: ApiError | null) => {\n\t\t\t\tfunction applyStatChanges() {\n\t\t\t\t\t// Check if mode changed.\n\t\t\t\t\tfd.stat((e, stats?) => {\n\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\tcb(e);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (stats!.mode !== remoteStats.mode) {\n\t\t\t\t\t\t\t\tfd.chmod(remoteStats.mode, (e: any) => {\n\t\t\t\t\t\t\t\t\tcb(e, fd);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcb(e, fd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (e) {\n\t\t\t\t\tcb(e);\n\t\t\t\t} else {\n\t\t\t\t\t// If writeable & not appendable, we need to ensure file contents are\n\t\t\t\t\t// identical to those from the remote FD. Thus, we truncate to the\n\t\t\t\t\t// length of the remote file.\n\t\t\t\t\tif (!flag.isAppendable()) {\n\t\t\t\t\t\tfd.truncate(data.length, () => {\n\t\t\t\t\t\t\tapplyStatChanges();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapplyStatChanges();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tcb(null, fd);\n\t\t}\n\t}\n}\n\n/**\n * @hidden\n */\ninterface IAPIErrorArgument extends ISpecialArgument {\n\t// The error object, as an array buffer.\n\terrorData: ArrayBuffer | SharedArrayBuffer;\n}\n\n/**\n * @hidden\n */\nfunction apiErrorLocal2Remote(e: ApiError): IAPIErrorArgument {\n\treturn {\n\t\ttype: SpecialArgType.API_ERROR,\n\t\terrorData: bufferToTransferrableObject(e.writeToBuffer()),\n\t};\n}\n\n/**\n * @hidden\n */\nfunction apiErrorRemote2Local(e: IAPIErrorArgument): ApiError {\n\treturn ApiError.fromBuffer(transferrableObjectToBuffer(e.errorData));\n}\n\n/**\n * @hidden\n */\ninterface IErrorArgument extends ISpecialArgument {\n\t// The name of the error (e.g. 'TypeError').\n\tname: string;\n\t// The message associated with the error.\n\tmessage: string;\n\t// The stack associated with the error.\n\tstack: string;\n}\n\n/**\n * @hidden\n */\nfunction errorLocal2Remote(e: Error): IErrorArgument {\n\treturn {\n\t\ttype: SpecialArgType.ERROR,\n\t\tname: e.name,\n\t\tmessage: e.message,\n\t\tstack: e.stack!,\n\t};\n}\n\n/**\n * @hidden\n */\nfunction errorRemote2Local(e: IErrorArgument): Error {\n\tlet cnstr: {\n\t\tnew (msg: string): Error;\n\t} = globalThis[e.name];\n\tif (typeof cnstr !== 'function') {\n\t\tcnstr = Error;\n\t}\n\tconst err = new cnstr(e.message);\n\terr.stack = e.stack;\n\treturn err;\n}\n\n/**\n * @hidden\n */\ninterface IStatsArgument extends ISpecialArgument {\n\t// The stats object as an array buffer.\n\tstatsData: ArrayBuffer | SharedArrayBuffer;\n}\n\n/**\n * @hidden\n */\nfunction statsLocal2Remote(stats: Stats): IStatsArgument {\n\treturn {\n\t\ttype: SpecialArgType.STATS,\n\t\tstatsData: bufferToTransferrableObject(stats.toBuffer()),\n\t};\n}\n\n/**\n * @hidden\n */\nfunction statsRemote2Local(stats: IStatsArgument): Stats {\n\treturn Stats.fromBuffer(transferrableObjectToBuffer(stats.statsData));\n}\n\n/**\n * @hidden\n */\ninterface IFileFlagArgument extends ISpecialArgument {\n\tflagStr: string;\n}\n\n/**\n * @hidden\n */\nfunction fileFlagLocal2Remote(flag: FileFlag): IFileFlagArgument {\n\treturn {\n\t\ttype: SpecialArgType.FILEFLAG,\n\t\tflagStr: flag.getFlagString(),\n\t};\n}\n\n/**\n * @hidden\n */\nfunction fileFlagRemote2Local(remoteFlag: IFileFlagArgument): FileFlag {\n\treturn FileFlag.getFileFlag(remoteFlag.flagStr);\n}\n\n/**\n * @hidden\n */\ninterface IBufferArgument extends ISpecialArgument {\n\tdata: ArrayBuffer | SharedArrayBuffer;\n}\n\n/**\n * @hidden\n */\nfunction bufferToTransferrableObject(buff: Buffer): ArrayBuffer | SharedArrayBuffer {\n\treturn buffer2ArrayBuffer(buff);\n}\n\n/**\n * @hidden\n */\nfunction transferrableObjectToBuffer(buff: ArrayBuffer | SharedArrayBuffer): Buffer {\n\treturn arrayBuffer2Buffer(buff);\n}\n\n/**\n * @hidden\n */\nfunction bufferLocal2Remote(buff: Buffer): IBufferArgument {\n\treturn {\n\t\ttype: SpecialArgType.BUFFER,\n\t\tdata: bufferToTransferrableObject(buff),\n\t};\n}\n\n/**\n * @hidden\n */\nfunction bufferRemote2Local(buffArg: IBufferArgument): Buffer {\n\treturn transferrableObjectToBuffer(buffArg.data);\n}\n\n/**\n * @hidden\n */\ninterface IAPIRequest extends IBrowserFSMessage {\n\tmethod: string;\n\targs: Array<number | string | ISpecialArgument>;\n}\n\n/**\n * @hidden\n */\nfunction isAPIRequest(data: any): data is IAPIRequest {\n\treturn data && typeof data === 'object' && Object.prototype.hasOwnProperty.call(data, 'browserfsMessage') && data['browserfsMessage'];\n}\n\n/**\n * @hidden\n */\ninterface IAPIResponse extends IBrowserFSMessage {\n\tcbId: number;\n\targs: Array<number | string | ISpecialArgument>;\n}\n\n/**\n * @hidden\n */\nfunction isAPIResponse(data: any): data is IAPIResponse {\n\treturn data && typeof data === 'object' && Object.prototype.hasOwnProperty.call(data, 'browserfsMessage') && data['browserfsMessage'];\n}\n\n/**\n * Represents a remote file in a different worker/thread.\n */\nclass WorkerFile extends PreloadFile<WorkerFS> {\n\tprivate _remoteFdId: number;\n\n\tconstructor(_fs: WorkerFS, _path: string, _flag: FileFlag, _stat: Stats, remoteFdId: number, contents?: Buffer) {\n\t\tsuper(_fs, _path, _flag, _stat, contents);\n\t\tthis._remoteFdId = remoteFdId;\n\t}\n\n\tpublic getRemoteFdId() {\n\t\treturn this._remoteFdId;\n\t}\n\n\t/**\n\t * @hidden\n\t */\n\tpublic toRemoteArg(): IFileDescriptorArgument {\n\t\treturn {\n\t\t\ttype: SpecialArgType.FD,\n\t\t\tid: this._remoteFdId,\n\t\t\tdata: bufferToTransferrableObject(this.getBuffer()),\n\t\t\tstat: bufferToTransferrableObject(this.getStats().toBuffer()),\n\t\t\tpath: this.getPath(),\n\t\t\tflag: this.getFlag().getFlagString(),\n\t\t};\n\t}\n\n\tpublic sync(cb: BFSOneArgCallback): void {\n\t\tthis._syncClose('sync', cb);\n\t}\n\n\tpublic close(cb: BFSOneArgCallback): void {\n\t\tthis._syncClose('close', cb);\n\t}\n\n\tprivate _syncClose(type: string, cb: BFSOneArgCallback): void {\n\t\tif (this.isDirty()) {\n\t\t\t(<WorkerFS>this._fs).syncClose(type, this, (e?: ApiError) => {\n\t\t\t\tif (!e) {\n\t\t\t\t\tthis.resetDirty();\n\t\t\t\t}\n\t\t\t\tcb(e);\n\t\t\t});\n\t\t} else {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nexport interface WorkerFSOptions {\n\t// The target worker that you want to connect to, or the current worker if in a worker context.\n\tworker: Worker;\n}\n\n/**\n * WorkerFS lets you access a BrowserFS instance that is running in a different\n * JavaScript context (e.g. access BrowserFS in one of your WebWorkers, or\n * access BrowserFS running on the main page from a WebWorker).\n *\n * For example, to have a WebWorker access files in the main browser thread,\n * do the following:\n *\n * MAIN BROWSER THREAD:\n *\n * ```javascript\n *   // Listen for remote file system requests.\n *   BrowserFS.FileSystem.WorkerFS.attachRemoteListener(webWorkerObject);\n * ```\n *\n * WEBWORKER THREAD:\n *\n * ```javascript\n *   // Set the remote file system as the root file system.\n *   BrowserFS.configure({ fs: \"WorkerFS\", options: { worker: self }}, function(e) {\n *     // Ready!\n *   });\n * ```\n *\n * Note that synchronous operations are not permitted on the WorkerFS, regardless\n * of the configuration option of the remote FS.\n */\nexport default class WorkerFS extends BaseFileSystem implements FileSystem {\n\tpublic static readonly Name = 'WorkerFS';\n\n\tpublic static readonly Options: FileSystemOptions = {\n\t\tworker: {\n\t\t\ttype: 'object',\n\t\t\tdescription: 'The target worker that you want to connect to, or the current worker if in a worker context.',\n\t\t\tvalidator: function (v: object, cb: BFSOneArgCallback): void {\n\t\t\t\t// Check for a `postMessage` function.\n\t\t\t\tif ((<any>v)['postMessage']) {\n\t\t\t\t\tcb();\n\t\t\t\t} else {\n\t\t\t\t\tcb(new ApiError(ErrorCode.EINVAL, `option must be a Web Worker instance.`));\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t};\n\n\tpublic static Create(opts: WorkerFSOptions, cb: BFSCallback<WorkerFS>): void {\n\t\tconst fs = new WorkerFS(opts.worker);\n\t\tfs._initialize(() => {\n\t\t\tcb(null, fs);\n\t\t});\n\t}\n\n\tpublic static CreateAsync(opts: WorkerFSOptions): Promise<WorkerFS> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.Create(opts, (error, fs) => {\n\t\t\t\tif (error || !fs) {\n\t\t\t\t\treject(error);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(fs);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic static isAvailable(): boolean {\n\t\treturn typeof importScripts !== 'undefined' || typeof Worker !== 'undefined';\n\t}\n\n\t/**\n\t * Attaches a listener to the remote worker for file system requests.\n\t */\n\tpublic static attachRemoteListener(worker: Worker) {\n\t\tconst fdConverter = new FileDescriptorArgumentConverter();\n\n\t\tfunction argLocal2Remote(arg: any, requestArgs: any[], cb: BFSCallback<any>): void {\n\t\t\tswitch (typeof arg) {\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (arg instanceof Stats) {\n\t\t\t\t\t\tcb(null, statsLocal2Remote(arg));\n\t\t\t\t\t} else if (arg instanceof ApiError) {\n\t\t\t\t\t\tcb(null, apiErrorLocal2Remote(arg));\n\t\t\t\t\t} else if (arg instanceof BaseFile) {\n\t\t\t\t\t\t// Pass in p and flags from original request.\n\t\t\t\t\t\tcb(null, fdConverter.toRemoteArg(<File>arg, requestArgs[0], requestArgs[1], cb));\n\t\t\t\t\t} else if (arg instanceof FileFlag) {\n\t\t\t\t\t\tcb(null, fileFlagLocal2Remote(arg));\n\t\t\t\t\t} else if (arg instanceof Buffer) {\n\t\t\t\t\t\tcb(null, bufferLocal2Remote(arg));\n\t\t\t\t\t} else if (arg instanceof Error) {\n\t\t\t\t\t\tcb(null, errorLocal2Remote(arg));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcb(null, arg);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tcb(null, arg);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfunction argRemote2Local(arg: any, fixedRequestArgs: any[]): any {\n\t\t\tif (!arg) {\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t\tswitch (typeof arg) {\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (typeof arg['type'] === 'number') {\n\t\t\t\t\t\tconst specialArg = <ISpecialArgument>arg;\n\t\t\t\t\t\tswitch (specialArg.type) {\n\t\t\t\t\t\t\tcase SpecialArgType.CB:\n\t\t\t\t\t\t\t\tconst cbId = (<ICallbackArgument>arg).id;\n\t\t\t\t\t\t\t\treturn function () {\n\t\t\t\t\t\t\t\t\tlet i: number;\n\t\t\t\t\t\t\t\t\tconst fixedArgs = new Array(arguments.length);\n\t\t\t\t\t\t\t\t\tlet message: IAPIResponse,\n\t\t\t\t\t\t\t\t\t\tcountdown = arguments.length;\n\n\t\t\t\t\t\t\t\t\tfunction abortAndSendError(err: ApiError) {\n\t\t\t\t\t\t\t\t\t\tif (countdown > 0) {\n\t\t\t\t\t\t\t\t\t\t\tcountdown = -1;\n\t\t\t\t\t\t\t\t\t\t\tmessage = {\n\t\t\t\t\t\t\t\t\t\t\t\tbrowserfsMessage: true,\n\t\t\t\t\t\t\t\t\t\t\t\tcbId: cbId,\n\t\t\t\t\t\t\t\t\t\t\t\targs: [apiErrorLocal2Remote(err)],\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\tworker.postMessage(message);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tfor (i = 0; i < arguments.length; i++) {\n\t\t\t\t\t\t\t\t\t\t// Capture i and argument.\n\t\t\t\t\t\t\t\t\t\t((i: number, arg: any) => {\n\t\t\t\t\t\t\t\t\t\t\targLocal2Remote(arg, fixedRequestArgs, (err, fixedArg?) => {\n\t\t\t\t\t\t\t\t\t\t\t\tfixedArgs[i] = fixedArg;\n\t\t\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tabortAndSendError(err);\n\t\t\t\t\t\t\t\t\t\t\t\t} else if (--countdown === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbrowserfsMessage: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcbId: cbId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\targs: fixedArgs,\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\tworker.postMessage(message);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t})(i, arguments[i]);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (arguments.length === 0) {\n\t\t\t\t\t\t\t\t\t\tmessage = {\n\t\t\t\t\t\t\t\t\t\t\tbrowserfsMessage: true,\n\t\t\t\t\t\t\t\t\t\t\tcbId: cbId,\n\t\t\t\t\t\t\t\t\t\t\targs: fixedArgs,\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tworker.postMessage(message);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tcase SpecialArgType.API_ERROR:\n\t\t\t\t\t\t\t\treturn apiErrorRemote2Local(<IAPIErrorArgument>specialArg);\n\t\t\t\t\t\t\tcase SpecialArgType.STATS:\n\t\t\t\t\t\t\t\treturn statsRemote2Local(<IStatsArgument>specialArg);\n\t\t\t\t\t\t\tcase SpecialArgType.FILEFLAG:\n\t\t\t\t\t\t\t\treturn fileFlagRemote2Local(<IFileFlagArgument>specialArg);\n\t\t\t\t\t\t\tcase SpecialArgType.BUFFER:\n\t\t\t\t\t\t\t\treturn bufferRemote2Local(<IBufferArgument>specialArg);\n\t\t\t\t\t\t\tcase SpecialArgType.ERROR:\n\t\t\t\t\t\t\t\treturn errorRemote2Local(<IErrorArgument>specialArg);\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t// No idea what this is.\n\t\t\t\t\t\t\t\treturn arg;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\treturn arg;\n\t\t\t}\n\t\t}\n\n\t\tworker.addEventListener('message', (e: MessageEvent) => {\n\t\t\tconst request: object = e.data;\n\t\t\tif (isAPIRequest(request)) {\n\t\t\t\tconst args = request.args,\n\t\t\t\t\tfixedArgs = new Array<any>(args.length);\n\n\t\t\t\tswitch (request.method) {\n\t\t\t\t\tcase 'close':\n\t\t\t\t\tcase 'sync':\n\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t// File descriptor-relative methods.\n\t\t\t\t\t\t\tconst remoteCb = <ICallbackArgument>args[1];\n\t\t\t\t\t\t\tfdConverter.applyFdAPIRequest(request, (err?: ApiError) => {\n\t\t\t\t\t\t\t\t// Send response.\n\t\t\t\t\t\t\t\tconst response: IAPIResponse = {\n\t\t\t\t\t\t\t\t\tbrowserfsMessage: true,\n\t\t\t\t\t\t\t\t\tcbId: remoteCb.id,\n\t\t\t\t\t\t\t\t\targs: err ? [apiErrorLocal2Remote(err)] : [],\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tworker.postMessage(response);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'probe':\n\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\tconst rootFs = <FileSystem>fs.getRootFS(),\n\t\t\t\t\t\t\t\tremoteCb = <ICallbackArgument>args[1],\n\t\t\t\t\t\t\t\tprobeResponse: IProbeResponse = {\n\t\t\t\t\t\t\t\t\ttype: SpecialArgType.PROBE,\n\t\t\t\t\t\t\t\t\tisReadOnly: rootFs.isReadOnly(),\n\t\t\t\t\t\t\t\t\tsupportsLinks: rootFs.supportsLinks(),\n\t\t\t\t\t\t\t\t\tsupportsProps: rootFs.supportsProps(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tresponse: IAPIResponse = {\n\t\t\t\t\t\t\t\t\tbrowserfsMessage: true,\n\t\t\t\t\t\t\t\t\tcbId: remoteCb.id,\n\t\t\t\t\t\t\t\t\targs: [probeResponse],\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tworker.postMessage(response);\n\t\t\t\t\t\t})();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t// File system methods.\n\t\t\t\t\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\t\t\t\t\tfixedArgs[i] = argRemote2Local(args[i], fixedArgs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst rootFS = fs.getRootFS();\n\t\t\t\t\t\t(<Function>(<any>rootFS)[request.method]).apply(rootFS, fixedArgs);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _worker: Worker;\n\tprivate _callbackConverter = new CallbackArgumentConverter();\n\n\tprivate _isInitialized: boolean = false;\n\tprivate _isReadOnly: boolean = false;\n\tprivate _supportLinks: boolean = false;\n\tprivate _supportProps: boolean = false;\n\n\t/**\n\t * Constructs a new WorkerFS instance that connects with BrowserFS running on\n\t * the specified worker.\n\t */\n\tprivate constructor(worker: Worker) {\n\t\tsuper();\n\t\tthis._worker = worker;\n\t\tthis._worker.addEventListener('message', (e: MessageEvent) => {\n\t\t\tconst resp: object = e.data;\n\t\t\tif (isAPIResponse(resp)) {\n\t\t\t\tlet i: number;\n\t\t\t\tconst args = resp.args;\n\t\t\t\tconst fixedArgs = new Array(args.length);\n\t\t\t\t// Dispatch event to correct id.\n\t\t\t\tfor (i = 0; i < fixedArgs.length; i++) {\n\t\t\t\t\tfixedArgs[i] = this._argRemote2Local(args[i]);\n\t\t\t\t}\n\t\t\t\tthis._callbackConverter.toLocalArg(resp.cbId).apply(null, fixedArgs);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getName(): string {\n\t\treturn WorkerFS.Name;\n\t}\n\n\tpublic isReadOnly(): boolean {\n\t\treturn this._isReadOnly;\n\t}\n\tpublic supportsSynch(): boolean {\n\t\treturn false;\n\t}\n\tpublic supportsLinks(): boolean {\n\t\treturn this._supportLinks;\n\t}\n\tpublic supportsProps(): boolean {\n\t\treturn this._supportProps;\n\t}\n\n\tpublic rename(oldPath: string, newPath: string, cred: Cred, cb: BFSOneArgCallback): void {\n\t\tthis._rpc('rename', arguments);\n\t}\n\tpublic stat(p: string, isLstat: boolean, cred: Cred, cb: BFSCallback<Stats>): void {\n\t\tthis._rpc('stat', arguments);\n\t}\n\tpublic open(p: string, flag: FileFlag, mode: number, cred: Cred, cb: BFSCallback<File>): void {\n\t\tthis._rpc('open', arguments);\n\t}\n\tpublic unlink(p: string, cred: Cred, cb: Function): void {\n\t\tthis._rpc('unlink', arguments);\n\t}\n\tpublic rmdir(p: string, cred: Cred, cb: Function): void {\n\t\tthis._rpc('rmdir', arguments);\n\t}\n\tpublic mkdir(p: string, mode: number, cred: Cred, cb: Function): void {\n\t\tthis._rpc('mkdir', arguments);\n\t}\n\tpublic readdir(p: string, cred: Cred, cb: BFSCallback<string[]>): void {\n\t\tthis._rpc('readdir', arguments);\n\t}\n\tpublic exists(p: string, cred: Cred, cb: (exists: boolean) => void): void {\n\t\tthis._rpc('exists', arguments);\n\t}\n\tpublic realpath(p: string, cache: { [path: string]: string }, cred: Cred, cb: BFSCallback<string>): void {\n\t\tthis._rpc('realpath', arguments);\n\t}\n\tpublic truncate(p: string, len: number, cred: Cred, cb: Function): void {\n\t\tthis._rpc('truncate', arguments);\n\t}\n\tpublic readFile(fname: string, encoding: string, flag: FileFlag, cred: Cred, cb: BFSCallback<any>): void {\n\t\tthis._rpc('readFile', arguments);\n\t}\n\tpublic writeFile(fname: string, data: any, encoding: string, flag: FileFlag, mode: number, cred: Cred, cb: BFSOneArgCallback): void {\n\t\tthis._rpc('writeFile', arguments);\n\t}\n\tpublic appendFile(fname: string, data: any, encoding: string, flag: FileFlag, mode: number, cred: Cred, cb: BFSOneArgCallback): void {\n\t\tthis._rpc('appendFile', arguments);\n\t}\n\tpublic chmod(p: string, isLchmod: boolean, mode: number, cred: Cred, cb: Function): void {\n\t\tthis._rpc('chmod', arguments);\n\t}\n\tpublic chown(p: string, isLchown: boolean, new_uid: number, new_gid: number, cred: Cred, cb: Function): void {\n\t\tthis._rpc('chown', arguments);\n\t}\n\tpublic utimes(p: string, atime: Date, mtime: Date, cred: Cred, cb: Function): void {\n\t\tthis._rpc('utimes', arguments);\n\t}\n\tpublic link(srcpath: string, dstpath: string, cred: Cred, cb: Function): void {\n\t\tthis._rpc('link', arguments);\n\t}\n\tpublic symlink(srcpath: string, dstpath: string, type: string, cred: Cred, cb: Function): void {\n\t\tthis._rpc('symlink', arguments);\n\t}\n\tpublic readlink(p: string, cred: Cred, cb: Function): void {\n\t\tthis._rpc('readlink', arguments);\n\t}\n\n\tpublic syncClose(method: string, fd: File, cb: BFSOneArgCallback): void {\n\t\tthis._worker.postMessage({\n\t\t\tbrowserfsMessage: true,\n\t\t\tmethod: method,\n\t\t\targs: [(<WorkerFile>fd).toRemoteArg(), this._callbackConverter.toRemoteArg(cb)],\n\t\t});\n\t}\n\n\t/**\n\t * Called once both local and remote sides are set up.\n\t */\n\tprivate _initialize(cb: () => void): void {\n\t\tif (!this._isInitialized) {\n\t\t\tconst message: IAPIRequest = {\n\t\t\t\tbrowserfsMessage: true,\n\t\t\t\tmethod: 'probe',\n\t\t\t\targs: [\n\t\t\t\t\tthis._argLocal2Remote(emptyBuffer()),\n\t\t\t\t\tthis._callbackConverter.toRemoteArg((probeResponse: IProbeResponse) => {\n\t\t\t\t\t\tthis._isInitialized = true;\n\t\t\t\t\t\tthis._isReadOnly = probeResponse.isReadOnly;\n\t\t\t\t\t\tthis._supportLinks = probeResponse.supportsLinks;\n\t\t\t\t\t\tthis._supportProps = probeResponse.supportsProps;\n\t\t\t\t\t\tcb();\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t};\n\t\t\tthis._worker.postMessage(message);\n\t\t} else {\n\t\t\tcb();\n\t\t}\n\t}\n\n\tprivate _argRemote2Local(arg: any): any {\n\t\tif (!arg) {\n\t\t\treturn arg;\n\t\t}\n\t\tswitch (typeof arg) {\n\t\t\tcase 'object':\n\t\t\t\tif (typeof arg['type'] === 'number') {\n\t\t\t\t\tconst specialArg = <ISpecialArgument>arg;\n\t\t\t\t\tswitch (specialArg.type) {\n\t\t\t\t\t\tcase SpecialArgType.API_ERROR:\n\t\t\t\t\t\t\treturn apiErrorRemote2Local(<IAPIErrorArgument>specialArg);\n\t\t\t\t\t\tcase SpecialArgType.FD:\n\t\t\t\t\t\t\tconst fdArg = <IFileDescriptorArgument>specialArg;\n\t\t\t\t\t\t\treturn new WorkerFile(\n\t\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\t\tfdArg.path,\n\t\t\t\t\t\t\t\tFileFlag.getFileFlag(fdArg.flag),\n\t\t\t\t\t\t\t\tStats.fromBuffer(transferrableObjectToBuffer(fdArg.stat)),\n\t\t\t\t\t\t\t\tfdArg.id,\n\t\t\t\t\t\t\t\ttransferrableObjectToBuffer(fdArg.data)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tcase SpecialArgType.STATS:\n\t\t\t\t\t\t\treturn statsRemote2Local(<IStatsArgument>specialArg);\n\t\t\t\t\t\tcase SpecialArgType.FILEFLAG:\n\t\t\t\t\t\t\treturn fileFlagRemote2Local(<IFileFlagArgument>specialArg);\n\t\t\t\t\t\tcase SpecialArgType.BUFFER:\n\t\t\t\t\t\t\treturn bufferRemote2Local(<IBufferArgument>specialArg);\n\t\t\t\t\t\tcase SpecialArgType.ERROR:\n\t\t\t\t\t\t\treturn errorRemote2Local(<IErrorArgument>specialArg);\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn arg;\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn arg;\n\t\t}\n\t}\n\n\tprivate _rpc(methodName: string, args: IArguments) {\n\t\tconst fixedArgs = new Array(args.length);\n\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\tfixedArgs[i] = this._argLocal2Remote(args[i]);\n\t\t}\n\t\tconst message: IAPIRequest = {\n\t\t\tbrowserfsMessage: true,\n\t\t\tmethod: methodName,\n\t\t\targs: fixedArgs,\n\t\t};\n\t\tthis._worker.postMessage(message);\n\t}\n\n\t/**\n\t * Converts a local argument into a remote argument. Public so WorkerFile objects can call it.\n\t */\n\tprivate _argLocal2Remote(arg: any): any {\n\t\tif (!arg) {\n\t\t\treturn arg;\n\t\t}\n\t\tswitch (typeof arg) {\n\t\t\tcase 'object':\n\t\t\t\tif (arg instanceof Stats) {\n\t\t\t\t\treturn statsLocal2Remote(arg);\n\t\t\t\t} else if (arg instanceof ApiError) {\n\t\t\t\t\treturn apiErrorLocal2Remote(arg);\n\t\t\t\t} else if (arg instanceof WorkerFile) {\n\t\t\t\t\treturn (<WorkerFile>arg).toRemoteArg();\n\t\t\t\t} else if (arg instanceof FileFlag) {\n\t\t\t\t\treturn fileFlagLocal2Remote(arg);\n\t\t\t\t} else if (arg instanceof Buffer) {\n\t\t\t\t\treturn bufferLocal2Remote(arg);\n\t\t\t\t} else if (arg instanceof Error) {\n\t\t\t\t\treturn errorLocal2Remote(arg);\n\t\t\t\t} else {\n\t\t\t\t\treturn 'Unknown argument';\n\t\t\t\t}\n\t\t\tcase 'function':\n\t\t\t\treturn this._callbackConverter.toRemoteArg(arg);\n\t\t\tdefault:\n\t\t\t\treturn arg;\n\t\t}\n\t}\n}\n"]}